Maze
===start\en
``A maze is a 2D grid of emoji, with some functions for checking the state at particular grid postions.
Mazes are generated randomly.``/en
â€¢Maze() (
	gridâ€¢[[''|Ã¸]]: 
		[
			[ 'ğŸ¬' 'â¤ï¸' 'âŒ'   Ã¸    Ã¸]
			[ 'â¤ï¸'   Ã¸    Ã¸    Ã¸    Ã¸]
			[ 'ğŸˆ' 'ğŸ˜€' 'ğŸ’¬' 'ğŸ«¥' 'ğŸ˜']
			[   Ã¸  'ğŸ‘'  Ã¸    Ã¸   'ğŸ˜•']
			[ 'ğŸ¤©' 'ğŸ¥¹'  Ã¸   'ğŸ˜«' 'ğŸ˜¡']
    	]
 
	Æ’ cell(rowâ€¢# column â€¢#) (
		cells: grid[row]
		cellsâ€¢[] ? cells[column] Ã¸
	)

	Æ’ allowed(rowâ€¢# columnâ€¢#) cell(row column)â€¢''
)

maze: Maze()

â€¢State(rowâ€¢# columnâ€¢# stepsâ€¢#) 
(
	Æ’ down() State(row + 1 column steps + 1)
	Æ’ up() State(row - 1 column steps + 1)
	Æ’ left() State(row column - 1 steps + 1)
	Æ’ right() State(row column + 1 steps + 1)
)

Æ’  allowed(stateâ€¢State rowâ€¢# colâ€¢#) maze.allowed(state.row + row state.column + col)

direction: Choice()
stateâ€¢State:  State(1 1 0) â€¦ âˆ† direction â€¦
		((direction = "left") & allowed(state 0 -1)) ? state.left()
			((direction = "right") & allowed(state 0 1)) ? state.right()
				((direction = "up") & allowed(state -1 0)) ? state.up()
					((direction = "down") & allowed(state 1 0)) ? state.down()
						state

current: ( cell: maze.cell(state.row state.column) cell ?? ' ')
up: maze.cell(state.row - 1 state.column)â€¢''
down: maze.cell(state.row + 1 state.column)â€¢''
left: maze.cell(state.row state.column - 1)â€¢''
right: maze.cell(state.row state.column + 1)â€¢''
won: current = 'ğŸ¤©'

Stage(
	[
		Group(
			Grid(3 3 0.25m)
			[
				Ã¸ Phrase('â†‘' name: 'up' selectable: up resting:Pose(opacity: up ? 1 0.2)) Ã¸
				Phrase('â†' name: 'left' selectable: left resting:Pose(opacity: left ? 1 0.2))
				Phrase(current resting:won ? 
									Sequence(spin() â³: 1s style: 'straight') 
									Pose())
				Phrase('â†’' name: 'right' selectable: right resting:Pose(opacity: right ? 1 0.2))
				Ã¸ Phrase('â†“' name: 'down' selectable: down resting:Pose(opacity: down ? 1 0.2)) Ã¸
			]
	  )
	]
  	place: Place(0m 0m -3m)
	face: 'Noto Emoji'
  	background: Color(0 0 0Â°)
	resting:Pose(Color(100 100 0Â°))
)